C     TEST_GAMLN_VNWRMS - TEST SLATEC GAMLN AND VNWRMS
C     ON IBM SYSTEM/360 FORTRAN G
C
      REAL GAMLN, VNWRMS, R1MACH
      INTEGER I1MACH
      REAL Z, RESULT, EXPECT, ERR
      REAL V(5), W(5)
      INTEGER I, IERR
C
      WRITE(6,100)
  100 FORMAT(' SLATEC GAMLN AND VNWRMS TEST')
      WRITE(6,110)
  110 FORMAT(' ============================='/)
C
C     ============================================================
C     FIRST, CHECK MACHINE CONSTANTS
C     ============================================================
      WRITE(6,120)
  120 FORMAT(' SINGLE PRECISION MACHINE CONSTANTS:')
      I = I1MACH(11)
      WRITE(6,130) I
  130 FORMAT('   I1MACH(11) SP BASE-B DIGITS=',I3)
      Z = R1MACH(1)
      WRITE(6,140) Z
  140 FORMAT('   R1MACH(1) SMALLEST=',E15.7)
      Z = R1MACH(2)
      WRITE(6,150) Z
  150 FORMAT('   R1MACH(2) LARGEST=',E15.7)
      Z = R1MACH(4)
      WRITE(6,160) Z
  160 FORMAT('   R1MACH(4) EPSILON=',E15.7)
      WRITE(6,170)
  170 FORMAT(' ')
C
C     ============================================================
C     TEST GAMLN - SINGLE PRECISION LOG GAMMA
C     ============================================================
      WRITE(6,200)
  200 FORMAT(' GAMLN TESTS (SINGLE PREC LOG GAMMA):')
C
C     GAMLN(1) = 0
      Z = 1.0
      RESULT = GAMLN(Z, IERR)
      EXPECT = 0.0
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
  210 FORMAT('   GAMLN(',F5.1,')=',E15.7/
     1       '         EXP=',E15.7,' ERR=',E10.2,' IERR=',I2)
C
C     GAMLN(2) = 0
      Z = 2.0
      RESULT = GAMLN(Z, IERR)
      EXPECT = 0.0
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
C     GAMLN(3) = LN(2) = 0.6931472
      Z = 3.0
      RESULT = GAMLN(Z, IERR)
      EXPECT = 0.6931472
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
C     GAMLN(5) = LN(24) = 3.1780538
      Z = 5.0
      RESULT = GAMLN(Z, IERR)
      EXPECT = 3.1780538
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
C     GAMLN(10) = LN(9!) = 12.801827
      Z = 10.0
      RESULT = GAMLN(Z, IERR)
      EXPECT = 12.801827
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
C     GAMLN(0.5) = LN(SQRT(PI)) = 0.5723649
      Z = 0.5
      RESULT = GAMLN(Z, IERR)
      EXPECT = 0.5723649
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
C     GAMLN(1.5) = LN(SQRT(PI)/2) = -0.1207822
      Z = 1.5
      RESULT = GAMLN(Z, IERR)
      EXPECT = -0.1207822
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,210) Z, RESULT, EXPECT, ERR, IERR
C
      WRITE(6,170)
C
C     ============================================================
C     TEST VNWRMS - WEIGHTED ROOT-MEAN-SQUARE NORM
C     ============================================================
      WRITE(6,300)
  300 FORMAT(' VNWRMS TESTS (WEIGHTED RMS NORM):')
C
C     VNWRMS([1,1,1,1,1], [1,1,1,1,1]) = 1.0
      DO 310 I = 1, 5
         V(I) = 1.0
         W(I) = 1.0
  310 CONTINUE
      RESULT = VNWRMS(5, V, W)
      EXPECT = 1.0
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,320) RESULT, EXPECT, ERR
  320 FORMAT('   VNWRMS([1,1,1,1,1],[1,1,1,1,1])=',E15.7/
     1       '                              EXP=',E15.7,' ERR=',E10.2)
C
C     VNWRMS([2,2,2,2,2], [2,2,2,2,2]) = 1.0
      DO 330 I = 1, 5
         V(I) = 2.0
         W(I) = 2.0
  330 CONTINUE
      RESULT = VNWRMS(5, V, W)
      EXPECT = 1.0
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,340) RESULT, EXPECT, ERR
  340 FORMAT('   VNWRMS([2,2,2,2,2],[2,2,2,2,2])=',E15.7/
     1       '                              EXP=',E15.7,' ERR=',E10.2)
C
C     VNWRMS([3,4], [1,1]) = SQRT((9+16)/2) = SQRT(12.5)
      V(1) = 3.0
      V(2) = 4.0
      W(1) = 1.0
      W(2) = 1.0
      RESULT = VNWRMS(2, V, W)
      EXPECT = 3.5355339
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,350) RESULT, EXPECT, ERR
  350 FORMAT('   VNWRMS([3,4],[1,1])=',E15.7/
     1       '                  EXP=',E15.7,' ERR=',E10.2)
C
C     VNWRMS([6,8], [2,2]) = SQRT((9+16)/2) = SQRT(12.5)
      V(1) = 6.0
      V(2) = 8.0
      W(1) = 2.0
      W(2) = 2.0
      RESULT = VNWRMS(2, V, W)
      EXPECT = 3.5355339
      ERR = ABS(RESULT - EXPECT)
      WRITE(6,360) RESULT, EXPECT, ERR
  360 FORMAT('   VNWRMS([6,8],[2,2])=',E15.7/
     1       '                  EXP=',E15.7,' ERR=',E10.2)
C
      WRITE(6,170)
      WRITE(6,400)
  400 FORMAT(' SLATEC GAMLN AND VNWRMS TEST COMPLETE')
      STOP
      END
C
C     ============================================================
C     GAMLN - SINGLE PRECISION LOG GAMMA
C     ============================================================
C     DECK GAMLN
      REAL FUNCTION GAMLN (Z, IERR)
C***BEGIN PROLOGUE  GAMLN
C***SUBSIDIARY
C***PURPOSE  Compute the logarithm of the Gamma function
C***LIBRARY   SLATEC
C***END PROLOGUE  GAMLN
C
      INTEGER I, I1M, K, MZ, NZ, IERR, I1MACH
      REAL CF, CON, FLN, FZ, GLN, RLN, S, TLG, TRM, TST, T1, WDTOL, Z,
     * ZDMY, ZINC, ZM, ZMIN, ZP, ZSQ
      REAL R1MACH
      DIMENSION CF(22), GLN(100)
C           LNGAMMA(N), N=1,100
      DATA GLN(1), GLN(2), GLN(3), GLN(4), GLN(5), GLN(6), GLN(7),
     1     GLN(8), GLN(9), GLN(10), GLN(11), GLN(12), GLN(13), GLN(14),
     2     GLN(15), GLN(16), GLN(17), GLN(18), GLN(19), GLN(20),
     3     GLN(21), GLN(22)/
     4     0.00000000000000000E+00,     0.00000000000000000E+00,
     5     6.93147180559945309E-01,     1.79175946922805500E+00,
     6     3.17805383034794562E+00,     4.78749174278204599E+00,
     7     6.57925121201010100E+00,     8.52516136106541430E+00,
     8     1.06046029027452502E+01,     1.28018274800814696E+01,
     9     1.51044125730755153E+01,     1.75023078458738858E+01,
     A     1.99872144956618861E+01,     2.25521638531234229E+01,
     B     2.51912211827386815E+01,     2.78992713838408916E+01,
     C     3.06718601060806728E+01,     3.35050734501368889E+01,
     D     3.63954452080330536E+01,     3.93398841871994940E+01,
     E     4.23356164607534850E+01,     4.53801388984769080E+01/
      DATA GLN(23), GLN(24), GLN(25), GLN(26), GLN(27), GLN(28),
     1     GLN(29), GLN(30), GLN(31), GLN(32), GLN(33), GLN(34),
     2     GLN(35), GLN(36), GLN(37), GLN(38), GLN(39), GLN(40),
     3     GLN(41), GLN(42), GLN(43), GLN(44)/
     4     4.84711813518352239E+01,     5.16066755677643736E+01,
     5     5.47847293981123192E+01,     5.80036052229805199E+01,
     6     6.12617017610020020E+01,     6.45575386270063311E+01,
     7     6.78897431371815350E+01,     7.12570389671680090E+01,
     8     7.46582363488301644E+01,     7.80922235533153106E+01,
     9     8.15579594561150372E+01,     8.50544670175815174E+01,
     A     8.85808275421976788E+01,     9.21361756036870925E+01,
     B     9.57196945421432025E+01,     9.93306124547874269E+01,
     C     1.02968198614513813E+02,     1.06631760260643459E+02,
     D     1.10320639714757395E+02,     1.14034211781461703E+02,
     E     1.17771881399745072E+02,     1.21533081515438634E+02/
      DATA GLN(45), GLN(46), GLN(47), GLN(48), GLN(49), GLN(50),
     1     GLN(51), GLN(52), GLN(53), GLN(54), GLN(55), GLN(56),
     2     GLN(57), GLN(58), GLN(59), GLN(60), GLN(61), GLN(62),
     3     GLN(63), GLN(64), GLN(65), GLN(66)/
     4     1.25317271149356895E+02,     1.29123933639127215E+02,
     5     1.32952575035616310E+02,     1.36802722637326368E+02,
     6     1.40673923648234259E+02,     1.44565743946344886E+02,
     7     1.48477766951773032E+02,     1.52409592584497358E+02,
     8     1.56360836303078785E+02,     1.60331128216630907E+02,
     9     1.64320112263195181E+02,     1.68327445448427652E+02,
     A     1.72352797139162802E+02,     1.76395848406997352E+02,
     B     1.80456291417543771E+02,     1.84533828861449491E+02,
     C     1.88628173423671591E+02,     1.92739047287844902E+02,
     D     1.96866181672889994E+02,     2.01009316399281527E+02,
     E     2.05168199482641199E+02,     2.09342586752536836E+02/
      DATA GLN(67), GLN(68), GLN(69), GLN(70), GLN(71), GLN(72),
     1     GLN(73), GLN(74), GLN(75), GLN(76), GLN(77), GLN(78),
     2     GLN(79), GLN(80), GLN(81), GLN(82), GLN(83), GLN(84),
     3     GLN(85), GLN(86), GLN(87), GLN(88)/
     4     2.13532241494563261E+02,     2.17736934113954227E+02,
     5     2.21956441819130334E+02,     2.26190548323727593E+02,
     6     2.30439043565776952E+02,     2.34701723442818268E+02,
     7     2.38978389561834323E+02,     2.43268849002982714E+02,
     8     2.47572914096186884E+02,     2.51890402209723194E+02,
     9     2.56221135550009525E+02,     2.60564940971863209E+02,
     A     2.64921649798552801E+02,     2.69291097651019823E+02,
     B     2.73673124285693704E+02,     2.78067573440366143E+02,
     C     2.82474292687630396E+02,     2.86893133295426994E+02,
     D     2.91323950094270308E+02,     2.95766601350760624E+02,
     E     3.00220948647014132E+02,     3.04686856765668715E+02/
      DATA GLN(89), GLN(90), GLN(91), GLN(92), GLN(93), GLN(94),
     1     GLN(95), GLN(96), GLN(97), GLN(98), GLN(99), GLN(100)/
     2     3.09164193580146922E+02,     3.13652829949879062E+02,
     3     3.18152639620209327E+02,     3.22663499126726177E+02,
     4     3.27185287703775217E+02,     3.31717887196928473E+02,
     5     3.36261181979198477E+02,     3.40815058870799018E+02,
     6     3.45379407062266854E+02,     3.49954118040770237E+02,
     7     3.54539085519440809E+02,     3.59134205369575399E+02/
C             COEFFICIENTS OF ASYMPTOTIC EXPANSION
      DATA CF(1), CF(2), CF(3), CF(4), CF(5), CF(6), CF(7), CF(8),
     1     CF(9), CF(10), CF(11), CF(12), CF(13), CF(14), CF(15),
     2     CF(16), CF(17), CF(18), CF(19), CF(20), CF(21), CF(22)/
     3     8.33333333333333333E-02,    -2.77777777777777778E-03,
     4     7.93650793650793651E-04,    -5.95238095238095238E-04,
     5     8.41750841750841751E-04,    -1.91752691752691753E-03,
     6     6.41025641025641026E-03,    -2.95506535947712418E-02,
     7     1.79644372368830573E-01,    -1.39243221690590112E+00,
     8     1.34028640441683920E+01,    -1.56848284626002017E+02,
     9     2.19310333333333333E+03,    -3.61087712537249894E+04,
     A     6.91472268851313067E+05,    -1.52382215394074162E+07,
     B     3.82900751391414141E+08,    -1.08822660357843911E+10,
     C     3.47320283765002252E+11,    -1.23696021422692745E+13,
     D     4.88788064793079335E+14,    -2.13203339609193739E+16/
C
C             LN(2*PI)
      DATA CON                    /     1.83787706640934548E+00/
C
C***FIRST EXECUTABLE STATEMENT  GAMLN
      IERR=0
      IF (Z.LE.0.0E0) GO TO 70
      IF (Z.GT.101.0E0) GO TO 10
      NZ = Z
      FZ = Z - NZ
      IF (FZ.GT.0.0E0) GO TO 10
      IF (NZ.GT.100) GO TO 10
      GAMLN = GLN(NZ)
      RETURN
   10 CONTINUE
      WDTOL = R1MACH(4)
      WDTOL = AMAX1(WDTOL,0.5E-18)
      I1M = I1MACH(11)
      RLN = R1MACH(5)*I1M
      FLN = AMIN1(RLN,20.0E0)
      FLN = AMAX1(FLN,3.0E0)
      FLN = FLN - 3.0E0
      ZM = 1.8000E0 + 0.3875E0*FLN
      MZ = ZM + 1
      ZMIN = MZ
      ZDMY = Z
      ZINC = 0.0E0
      IF (Z.GE.ZMIN) GO TO 20
      ZINC = ZMIN - NZ
      ZDMY = Z + ZINC
   20 CONTINUE
      ZP = 1.0E0/ZDMY
      T1 = CF(1)*ZP
      S = T1
      IF (ZP.LT.WDTOL) GO TO 40
      ZSQ = ZP*ZP
      TST = T1*WDTOL
      DO 30 K=2,22
        ZP = ZP*ZSQ
        TRM = CF(K)*ZP
        IF (ABS(TRM).LT.TST) GO TO 40
        S = S + TRM
   30 CONTINUE
   40 CONTINUE
      IF (ZINC.NE.0.0E0) GO TO 50
      TLG = ALOG(Z)
      GAMLN = Z*(TLG-1.0E0) + 0.5E0*(CON-TLG) + S
      RETURN
   50 CONTINUE
      ZP = 1.0E0
      NZ = ZINC
      DO 60 I=1,NZ
        ZP = ZP*(Z+(I-1))
   60 CONTINUE
      TLG = ALOG(ZDMY)
      GAMLN = ZDMY*(TLG-1.0E0) - ALOG(ZP) + 0.5E0*(CON-TLG) + S
      RETURN
C
C
   70 CONTINUE
      GAMLN = R1MACH(2)
      IERR=1
      RETURN
      END
C
C     ============================================================
C     VNWRMS - WEIGHTED ROOT-MEAN-SQUARE NORM
C     ============================================================
C     DECK VNWRMS
      REAL FUNCTION VNWRMS (N, V, W)
C***BEGIN PROLOGUE  VNWRMS
C***SUBSIDIARY
C***PURPOSE  Subsidiary to DEBDF
C***LIBRARY   SLATEC
C***END PROLOGUE  VNWRMS
C
C-----------------------------------------------------------------------
C THIS FUNCTION ROUTINE COMPUTES THE WEIGHTED ROOT-MEAN-SQUARE NORM
C OF THE VECTOR OF LENGTH N CONTAINED IN THE ARRAY V, WITH WEIGHTS
C CONTAINED IN THE ARRAY W OF LENGTH N..
C   VNWRMS = SQRT( (1/N) * SUM( V(I)/W(I) )**2 )
C-----------------------------------------------------------------------
      INTEGER N, I
      REAL V(N), W(N), SUM
C***FIRST EXECUTABLE STATEMENT  VNWRMS
      SUM = 0.0E0
      DO 10 I = 1,N
 10     SUM = SUM + (V(I)/W(I))**2
      VNWRMS = SQRT(SUM/N)
      RETURN
C----------------------- END OF FUNCTION VNWRMS ------------------------
      END
C
C     ============================================================
C     R1MACH - SINGLE PRECISION MACHINE CONSTANTS
C     ============================================================
C     DECK R1MACH
      REAL FUNCTION R1MACH (I)
C***BEGIN PROLOGUE  R1MACH
C***PURPOSE  Return floating point machine dependent constants.
C***LIBRARY   SLATEC
C***END PROLOGUE  R1MACH
C
C     SINGLE-PRECISION MACHINE CONSTANTS FOR IBM 360/370
C     R1MACH(1) = B**(EMIN-1), THE SMALLEST POSITIVE MAGNITUDE.
C     R1MACH(2) = B**EMAX*(1 - B**(-T)), THE LARGEST MAGNITUDE.
C     R1MACH(3) = B**(-T), THE SMALLEST RELATIVE SPACING.
C     R1MACH(4) = B**(1-T), THE LARGEST RELATIVE SPACING.
C     R1MACH(5) = LOG10(B)
C
C     IBM 360/370: B=16, T=6 (hex digits), EMIN=-64, EMAX=63
C
      INTEGER I
      INTEGER IMACH(10)
      REAL RMACH(5)
      EQUIVALENCE (RMACH(1),IMACH(1))
C
C     RMACH(1) = 16**(-65) = 5.4E-79 APPROXIMATELY
C     HEX: 00100000 00000000
      DATA IMACH(1) /    1048576 /
      DATA IMACH(2) /          0 /
C
C     RMACH(2) = 16**63 * (1 - 16**(-6)) = 7.2E+75 APPROXIMATELY
C     HEX: 7FFFFFFF FFFFFFFF
      DATA IMACH(3) / 2147483647 /
      DATA IMACH(4) /         -1 /
C
C     RMACH(3) = 16**(-6) = 5.96E-8 APPROXIMATELY
C     HEX: 3A100000 00000000
      DATA IMACH(5) /  973078528 /
      DATA IMACH(6) /          0 /
C
C     RMACH(4) = 16**(-5) = 9.54E-7 APPROXIMATELY
C     HEX: 3B100000 00000000
      DATA IMACH(7) /  990904320 /
      DATA IMACH(8) /          0 /
C
C     RMACH(5) = LOG10(16) = 1.2041199826559248
C     HEX: 41134413 509F79FF (approximately)
      DATA RMACH(5) / 1.2041199826559248E0 /
C
C***FIRST EXECUTABLE STATEMENT  R1MACH
      R1MACH = RMACH(I)
      RETURN
      END
C
C     ============================================================
C     I1MACH - INTEGER MACHINE CONSTANTS
C     ============================================================
C     DECK I1MACH
      INTEGER FUNCTION I1MACH (I)
C***BEGIN PROLOGUE  I1MACH
C***PURPOSE  Return integer machine dependent constants.
C***LIBRARY   SLATEC
C***END PROLOGUE  I1MACH
C
C     INTEGER MACHINE CONSTANTS FOR IBM 360/370
C
      INTEGER I
      INTEGER IMACH(16)
C
C     I1MACH(1) = STANDARD INPUT UNIT
C     I1MACH(2) = STANDARD OUTPUT UNIT
C     I1MACH(3) = STANDARD PUNCH UNIT
C     I1MACH(4) = STANDARD ERROR UNIT
C     I1MACH(5) = BITS PER BYTE
C     I1MACH(6) = BYTES PER INTEGER
C     I1MACH(7) = RADIX FOR INTEGERS
C     I1MACH(8) = LARGEST INTEGER = 2**31-1
C     I1MACH(9) = RADIX FOR FLOATING-POINT = 16
C     I1MACH(10) = EXPONENT RANGE (MIN) = -64
C     I1MACH(11) = NUMBER OF MANTISSA DIGITS (SP) = 6
C     I1MACH(12) = EXPONENT RANGE (MAX) = 63
C     I1MACH(13) = NUMBER OF MANTISSA DIGITS (DP) = 14
C     I1MACH(14) = NUMBER OF MANTISSA DIGITS (DP) = 14
C
      DATA IMACH( 1) /          5 /
      DATA IMACH( 2) /          6 /
      DATA IMACH( 3) /          7 /
      DATA IMACH( 4) /          6 /
      DATA IMACH( 5) /          8 /
      DATA IMACH( 6) /          4 /
      DATA IMACH( 7) /          2 /
      DATA IMACH( 8) / 2147483647 /
      DATA IMACH( 9) /         16 /
      DATA IMACH(10) /        -64 /
      DATA IMACH(11) /          6 /
      DATA IMACH(12) /         63 /
      DATA IMACH(13) /         14 /
      DATA IMACH(14) /         14 /
C
C***FIRST EXECUTABLE STATEMENT  I1MACH
      I1MACH = IMACH(I)
      RETURN
      END
